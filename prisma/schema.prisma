generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

type MessageDataChannelAndMessageIds {
  channelId String
  messageId String
}

type MessageDataReference {
  channelId String
  guildId   String?
  messageId String?
}

type UserDataWarnings {
  automated   Boolean
  moderatorId String?
  id          String
  reason      String
  timestamp   DateTime
}

type HubRating {
  userId String
  rating Int    @default(0)
}

type HubModerator {
  userId   String
  position String @default("network_mod") // network, manager 
  // network -> just basic actions like warning/muting
  // manager -> perm blacklisting, managing hub etc.
  // honestly... I might as well make permissions lol
}

// type HubSettings {
//   useNicknames    Boolean @default(false)
//   allowInvites    Boolean @default(true)
//   allowLinks      Boolean @default(true)
//   allowReactions  Boolean @default(true)
//   profanityFilter Boolean @default(false)
//   spamFilter      Boolean @default(true)
// }

type HubLogChannels {
  reports   String?
  modLogs   String?
  joinLeave String?
  profanity String?
}

type hubBlacklist {
  reason      String
  expires     DateTime?
  moderatorId String?
  hubId       String    @db.ObjectId
}

model blacklistedServers {
  id         String         @id @default(auto()) @map("_id") @db.ObjectId
  serverId   String         @unique
  serverName String
  hubs       hubBlacklist[]
}

model connectedList {
  id         String   @id @default(auto()) @map("_id") @db.ObjectId
  channelId  String   @unique // channel can be thread, or a normal channel
  parentId   String? // ID of the parent channel, if it's a thread @map("parentChannelId")
  serverId   String
  connected  Boolean
  compact    Boolean
  invite     String?
  profFilter Boolean
  embedColor String?
  webhookURL String
  date       DateTime @default(now())
  hub        hubs?    @relation(fields: [hubId], references: [id])
  hubId      String   @db.ObjectId
}

model hubs {
  id          String          @id @default(auto()) @map("_id") @db.ObjectId
  name        String          @unique
  description String
  rating      HubRating[]
  ownerId     String
  iconUrl     String
  bannerUrl   String?
  private     Boolean         @default(true)
  createdAt   DateTime        @default(now())
  // settings are stored as a number, each bit is a setting
  settings    Int
  // all the stuff below is relations to other collections
  invites     hubInvites[]
  messages    messageData[]
  moderators  HubModerator[]
  connections connectedList[]
  logChannels HubLogChannels?
  // approved           Boolean              @default(false)
  // official           Boolean              @default(false)
}

model hubInvites {
  id      String   @id @default(auto()) @map("_id") @db.ObjectId
  code    String   @unique @default(nanoid(10))
  expires DateTime
  hub     hubs     @relation(fields: [hubId], references: [id])
  hubId   String   @db.ObjectId
}

model messageData {
  id                   String                            @id @default(auto()) @map("_id") @db.ObjectId
  authorId             String
  channelAndMessageIds MessageDataChannelAndMessageIds[]
  referenceDocId       String?                           @db.ObjectId
  serverId             String
  timestamp            DateTime
  reactions            Json? // eg. {"ðŸ‘Ž": ["9893820930928", "39283902803982"]} "emoji": userId[] basically
  hub                  hubs?                             @relation(fields: [hubId], references: [id])
  hubId                String?                           @db.ObjectId
}

model userBadges {
  userId String   @id @map("_id")
  badges String[]
}

model blacklistedUsers {
  id       String         @id @default(auto()) @map("_id") @db.ObjectId
  userId   String         @unique
  username String
  hubs     hubBlacklist[]
}

model userData {
  id                   String         @id @default(auto()) @map("_id") @db.ObjectId
  userId               String         @unique
  username             String
  locale               String?
  blacklistedFrom      hubBlacklist[]
  // if user has seen the welcome message when they first use the network
  viewedNetworkWelcome Boolean        @default(false)
}
